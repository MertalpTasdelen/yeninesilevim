{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">{{ form.instance.id|yesno:"√úr√ºn√º D√ºzenle,Yeni √úr√ºn Ekle" }}</h2>

    <form method="post">
        {% csrf_token %}

        <div class="mb-3">
            {{ form.name.label_tag }}
            {{ form.name }}
        </div>

        <div class="mb-3">
            {{ form.barcode.label_tag }}
            {{ form.barcode }}
        </div>

        <!-- ‚úÖ Alƒ±≈ü Barkodu √∂zel alan -->
        <div class="mb-3">
            {{ form.purchase_barcode.label_tag }}
            <div class="input-group">
                {{ form.purchase_barcode }}
                <button type="button" id="openCamera" class="btn btn-outline-secondary">
                    üì∑
                </button>
            </div>
        </div>

        <div class="mb-3">
            {{ form.purchase_price.label_tag }}
            {{ form.purchase_price }}
        </div>

        <div class="mb-3">
            {{ form.selling_price.label_tag }}
            {{ form.selling_price }}
        </div>

        <div class="mb-3">
            {{ form.commution.label_tag }}
            {{ form.commution }}
        </div>

        <div class="mb-3">
            {{ form.stock.label_tag }}
            {{ form.stock }}
        </div>

        <div class="mb-3">
            {{ form.image_url.label_tag }}
            {{ form.image_url }}
        </div>

        <button type="submit" class="btn btn-primary">Kaydet</button>
    </form>
    {% if form.instance.id %}
    <hr>
    <form method="post" action="{% url 'delete_product' form.instance.id %}" onsubmit="return confirm('Bu √ºr√ºn√º silmek istediƒüinize emin misiniz?');">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">Sil</button>
    </form>
    {% endif %}
</div>

<!-- ‚úÖ Kamera entegrasyonu -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const purchaseBarcodeInput = document.getElementById('id_purchase_barcode');
    const openCameraButton = document.getElementById('openCamera');

    function handleBarcodeMessage(event) {
        if (event.data && event.data.type === 'barcode_scanned' && event.data.field === 'purchase_barcode') {
            purchaseBarcodeInput.value = event.data.value;
        }
    }

    if (openCameraButton) {
        openCameraButton.addEventListener('click', () => {
            window.open("{% url 'camera_view' %}?field=purchase_barcode", "_blank", "width=800,height=600");
        });
    }

    window.addEventListener('message', handleBarcodeMessage);
});
</script>
{% endblock %}
