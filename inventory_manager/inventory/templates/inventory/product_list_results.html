{% comment %}
This template renders a paginated list of products. To protect
sensitive business information (purchase price, commission rates and
stock levels) when the viewer has not authenticated, the values
are conditionally displayed.
{% endcomment %}

{% for product in page_obj %}
<div class="product-card">
    <!-- Product Image -->
    <div class="product-image-wrapper">
        {% if product.image_url %}
        <img src="{{ product.image_url }}" 
             class="product-image" 
             alt="{{ product.name }}"
             onerror="this.parentElement.innerHTML='<div class=\'product-image-placeholder\'><i class=\'bi bi-image\' style=\'font-size: 3rem;\'></i></div>'">
        {% else %}
        <div class="product-image-placeholder">
            <i class="bi bi-image" style="font-size: 3rem;"></i>
        </div>
        {% endif %}
        
        <!-- Hover Overlay (Desktop only) -->
        {% if request.session.is_logged_in %}
        <div class="product-overlay">
            <div class="product-actions">
                <button class="action-btn" 
                        onclick="calculatePrice('{{ product.barcode }}', '{{ product.selling_price }}', '{{ product.commution }}'); event.stopPropagation();" 
                        title="Kâr Hesapla">
                    <i class="bi bi-calculator"></i>
                </button>
                <a href="{% url 'edit_product' product.id %}" 
                   class="action-btn" 
                   title="Düzenle">
                    <i class="bi bi-pencil"></i>
                </a>
                <button class="action-btn" 
                        onclick="adjustStockAjax({{ product.id }}, 1); event.stopPropagation();" 
                        title="Artır">
                    <i class="bi bi-plus"></i>
                </button>
                <button class="action-btn" 
                        onclick="adjustStockAjax({{ product.id }}, -1); event.stopPropagation();" 
                        title="Azalt">
                    <i class="bi bi-dash"></i>
                </button>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Product Info -->
    <div class="product-info">
        <div class="product-category">{{ product.barcode }}</div>
        <div class="product-name">{{ product.name }}</div>
        
        {% if request.session.is_logged_in %}
        <div class="product-price">
            <span>{{ product.purchase_price }} ₺</span>
            <span style="color: var(--color-text-light); margin-left: 0.5rem;">→ {{ product.selling_price }} ₺</span>
        </div>
        <div style="font-size: 0.875rem; color: var(--color-text-light); margin-top: 0.25rem;">
            Komisyon: %{{ product.commution }} | Stok: <span id="stock-{{ product.id }}">{{ product.stock }}</span>
        </div>
        {% else %}
        <div class="product-price">{{ product.selling_price }} ₺</div>
        <div style="font-size: 0.875rem; color: var(--color-text-light); margin-top: 0.25rem;">
            Detaylar için giriş yapın
        </div>
        {% endif %}
        
        <!-- Mobile Controls -->
        {% if request.session.is_logged_in %}
        <div class="mobile-controls">
            <button class="mobile-control-btn" onclick="calculatePrice('{{ product.barcode }}', '{{ product.selling_price }}', '{{ product.commution }}')">
                <i class="bi bi-calculator"></i>
            </button>
            <a href="{% url 'edit_product' product.id %}" class="mobile-control-btn">
                <i class="bi bi-pencil"></i>
            </a>
            <button class="mobile-control-btn" onclick="adjustStockAjax({{ product.id }}, 1)">
                <i class="bi bi-plus"></i>
            </button>
            <button class="mobile-control-btn" onclick="adjustStockAjax({{ product.id }}, -1)">
                <i class="bi bi-dash"></i>
            </button>
        </div>
        {% endif %}
    </div>
</div>
{% empty %}
<div class="col-12">
    <div class="empty-state">
        <i class="bi bi-bag-x"></i>
        <p>Ürün bulunamadı.</p>
    </div>
</div>
{% endfor %}
