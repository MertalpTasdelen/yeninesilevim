{% extends 'base.html' %}

{% block title %}QR Code Scanner{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center">QR Code Scanner</h1>
    <div class="d-flex justify-content-center">
        <!-- QR Code Reader Container -->
        <div id="reader" style="width: 300px;"></div>
    </div>
    <div id="result" class="mt-3 text-center text-success font-weight-bold"></div>
</div>

<!-- Include html5-qrcode -->
<script src="https://cdn.jsdelivr.net/npm/html5-qrcode/minified/html5-qrcode.min.js" defer></script>

<script>
window.onload = function () {
    function onScanSuccess(decodedText, decodedResult) {
        console.log(`QR Code detected: ${decodedText}`, decodedResult);

        window.location.href = `{% url 'product_list' %}?q=${encodeURIComponent(decodedText)}`;

    }

    function onScanFailure(error) {
        console.warn(`QR Code scanning failed: ${error}`);
    }

    // Initialize the QR Code scanner
    const html5QrCode = new Html5Qrcode("reader");
    const qrCodeScannerConfig = { fps: 10, qrbox: { width: 250, height: 250 } };

    html5QrCode.start(
        { facingMode: "environment" },
        qrCodeScannerConfig,
        onScanSuccess,
        onScanFailure
    ).catch(err => {
        console.error("QR Code scanning error: ", err);
    });
};
</script>

{% endblock %}